<!-- productos-vip.html -->
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Productos VIP - ZMLX</title>
  <link rel="stylesheet" href="./css/style.css" />
  <link rel="stylesheet" href="./css/productos.css" />
</head>
<body>
  <div class="bg-orbs" aria-hidden="true">
    <span class="orb o1"></span><span class="orb o3"></span>
  </div>

  <button class="menu-btn" id="menuBtn">☰</button>
  <div class="menu-panel" id="menuPanel">
    <a id="contactAdmin" href="#">Contactar con admin</a>
    <a href="./login.html">Eres admin</a>
  </div>

  <div class="container">
    <a href="./index.html" class="btn floating" style="margin-bottom:14px">← Volver</a>
    <h2 class="title">VIP</h2>
    <p class="subtitle">Selecciona un precio y compra a través de WhatsApp.</p>

    <div id="products" class="product-list"></div>
  </div>

  <div class="footer">Z•M•L•X RED TEAM</div>

  <script type="module">
    import { db } from './js/firebase.js';
    import { collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

    const menuBtn = document.getElementById('menuBtn');
    const menuPanel = document.getElementById('menuPanel');
    const contactAdmin = document.getElementById('contactAdmin');
    menuBtn.addEventListener('click', ()=> menuPanel.style.display = menuPanel.style.display === 'block' ? 'none' : 'block');
    contactAdmin.href = 'https://wa.me/573142369516?text=' + encodeURIComponent('hola vengo de la pagina web');

    const productsRoot = document.getElementById('products');

    async function loadVip(){
      productsRoot.innerHTML = 'Cargando...';
      const q = query(collection(db, 'vip'), orderBy('createdAt','desc'));
      const snap = await getDocs(q);
      productsRoot.innerHTML = '';
      if(snap.empty){ productsRoot.innerHTML = '<div class="card">No hay publicaciones VIP.</div>'; return; }
      snap.forEach(doc => {
        const p = doc.data();
        const div = document.createElement('div');
        div.className = 'product-card card';
        const prices = Array.isArray(p.prices) ? p.prices : (p.prices ? String(p.prices).split('|') : []);
        const youtubeEmbed = p.youtubeURL ? `<iframe style="width:100%;height:180px;border-radius:8px" src="https://www.youtube.com/embed/${extractYT(p.youtubeURL)}" frameborder="0" allowfullscreen></iframe>` : '';
        div.innerHTML = `
          <img src="${p.imageURL || 'https://via.placeholder.com/600x320?text=sin+imagen'}" alt="${escapeHtml(p.title)}"/>
          <h3>${escapeHtml(p.title)}</h3>
          <p>${escapeHtml(p.description || '')}</p>
          ${youtubeEmbed}
          <div class="product-actions">
            ${prices.map(pr => `<button class="btn floating price-btn" data-title="${escapeHtml(p.title)}" data-price="${escapeHtml(pr)}" data-phone="${escapeHtml(p.adminPhone||'+573142369516')}">${escapeHtml(pr)}</button>`).join('')}
          </div>
        `;
        productsRoot.appendChild(div);
      });

      // attach click handlers for price buttons
      document.querySelectorAll('.price-btn').forEach(b=>{
        b.addEventListener('click', (e)=>{
          const title = b.getAttribute('data-title') || 'producto';
          const price = b.getAttribute('data-price') || '';
          const phone = (b.getAttribute('data-phone') || '+573142369516').replace(/[^\d+]/g,'');
          const text = encodeURIComponent(`hola me interesa ${title} de ${price}`);
          window.open(`https://wa.me/${phone.replace('+','') }?text=${text}`, '_blank');
        });
      });
    }

    function extractYT(url=''){
      try{
        const u = new URL(url);
        if(u.hostname.includes('youtube.com')) return u.searchParams.get('v');
        if(u.hostname.includes('youtu.be')) return u.pathname.slice(1);
      }catch(e){}
      return '';
    }
    function escapeHtml(s=''){return String(s).replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[c]))}
    loadVip();
  </script>
</body>
</html>
